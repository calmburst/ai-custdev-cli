# Пошаговый запуск нового проекта

Этот файл объясняет, как сделать новый прогон на основе примера. Инструкция
написана для пользователя без технического опыта.

## 1) Подготовка
1. Установите Node.js 18 или новее.
2. Откройте папку проекта `ai-custdev-cli`.
3. Запустите командную строку внутри этой папки.
4. Выполните установку зависимостей:
   ```bash
   npm install
   ```

## 2) Настройка ключа
1. Скопируйте файл `.env.example` в `.env`.
2. Откройте `.env` и вставьте ваш ключ:
   ```
   OPENROUTER_API_KEY=ваш_ключ_здесь
   ```
3. Сохраните файл.

## 3) Создание нового конфига
1. Откройте папку `config/projects/`.
2. Возьмите пример `demo_cooking.json` и скопируйте его, например в
   `my_project.json`.
3. Откройте новый файл `my_project.json` и замените ключевые поля:

### 3.1 Meta (что мы исследуем)
```json
"meta": {
  "projectName": "my_project",
  "description": "Короткое описание задачи исследования."
}
```

### 3.2 Settings (сколько интервью и язык)
```json
"settings": {
  "iterations": 10,
  "concurrency": 2,
  "lang": "ru"
}
```
- `iterations` — сколько интервью нужно провести.
- `concurrency` — сколько интервью запускать параллельно (начните с 1–2).
- `lang` — язык всех результатов. По умолчанию `ru`.

### 3.3 Segments (группы пользователей)
Каждый сегмент — это тип пользователя. Важно, чтобы:
- `id` был коротким и латиницей (например `tourist`, `pro`).
- `weight` — доля сегмента (сумма всех весов должна быть 1.0).

Пример:
```json
"segments": [
  {
    "id": "tourist",
    "name": "Туристы",
    "weight": 0.5,
    "traits": ["Редкие обмены", "Ориентация на удобство"],
    "tooling": ["Google Maps"],
    "painPoints": ["Скрытые комиссии"],
    "cadence": "разово"
  },
  {
    "id": "pro",
    "name": "Профи",
    "weight": 0.5,
    "traits": ["Частые сделки", "Чувствительность к курсу"],
    "tooling": ["таблицы", "чаты"],
    "painPoints": ["Потери времени"],
    "cadence": "ежедневно"
  }
]
```

### 3.4 InterviewFlow (вопросы интервью)
Это список вопросов. Пишите их на нужном языке.
```json
"interviewFlow": {
  "context": "Короткий контекст для респондента.",
  "interviewerMode": "script",
  "script": [
    "Вопрос 1",
    "Вопрос 2",
    "Вопрос 3"
  ]
}
```

### 3.5 AnalyticsSchema (какие выводы хотим)
Это список полей, которые нужно извлечь из интервью:
```json
"analyticsSchema": [
  { "key": "would_use", "description": "Пользовался бы продуктом?" },
  { "key": "needed_features", "description": "Критичные функции" }
]
```
- `key` — короткое имя поля латиницей (без пробелов).
- `description` — что нужно извлечь из ответа.

### 3.6 Models (какие модели использовать)
Для начала можно использовать бесплатные модели:
```json
"models": {
  "generator": "deepseek/deepseek-r1-0528:free",
  "interviewer": "mistralai/mistral-7b-instruct:free",
  "respondent": "mistralai/mistral-7b-instruct:free",
  "analyzer": "mistralai/mistral-7b-instruct:free"
}
```

## 4) Запуск нового проекта
В командной строке выполните:
```bash
npm start -- --project my_project --run-tag first
```
Если хотите пропустить подтверждение:
```bash
npm start -- --project my_project --run-tag first --yes
```

## 5) Где искать результаты
После завершения прогона результаты появятся в папке:
```
output/<project>/<run>/
```
Например:
```
output/my_project/2025-12-25_13-22-42Z__first/
```
Внутри:
- `personas.json` — сгенерированные персоны.
- `logs/*.json` — диалоги интервью.
- `analysis.csv` — таблица с метриками.
- `summary.json` — сводка по сегментам.
- `advice.md` — рекомендации по улучшению запуска.

## 6) Если нужен другой язык
1. Поставьте нужный язык в `settings.lang`, например `en`.
2. Перепишите `description`, `segments`, `interviewFlow.script`,
   `analyticsSchema.description` на этот язык.
3. Можно запустить с флагом, если хотите временно изменить язык:
   ```bash
   npm start -- --project my_project --lang en
   ```

## 7) Fallback модели (если анализатор пустой)
1. Откройте файл `config/fallback-models.json`.
2. По умолчанию там уже 5 бесплатных моделей.
3. Укажите список моделей, которые можно использовать как запасные.
4. CLI автоматически попробует их, если основной анализатор не вернул JSON.

## 8) Частые проблемы
- Нет ключа: проверьте `.env` и значение `OPENROUTER_API_KEY`.
- Слишком долго: уменьшите `iterations` или `concurrency`.
- Нужно проверить ключ: добавьте `--check-key` при запуске.
